<!doctype html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TEXID</title>
    <meta name="description" content="Tetris moderne thème acier/carbone avec score, top 10, sons et effets visuels." />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet" />
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3E%3Crect width='16' height='16' rx='3' fill='%230b0f14'/%3E%3Cpath d='M2 8h12M8 2v12' stroke='%237dd3fc' stroke-width='2'/%3E%3C/svg%3E" />
    <link rel="stylesheet" href="/src/style.css" />
  </head>
  <body>
    <div id="toast" class="toast hidden" role="status" aria-live="polite"></div>
    <!-- Écran de démarrage (héro animé) -->
    <section id="screen-start" class="screen active">
      <div class="hero">
        <canvas id="hero-bg" class="hero-bg" aria-hidden="true"></canvas>
        <div class="hero-veil"></div>
        <canvas id="hero-fx" class="hero-fx" aria-hidden="true"></canvas>
        <div class="hero-content">
          <div class="logo-wrap" aria-label="TEXID">
            <!-- Logo image (fourni par l'utilisateur). Si l'image n'est pas présente, on garde le fallback SVG -->
            <img width="200" src="assets/images/logo-texid.png" alt="TEXID" class="logo-img" onload="this.style.display='block'; this.nextElementSibling?.classList.add('hidden');" onerror="this.style.display='none'; this.nextElementSibling?.classList.remove('hidden');" />
            <svg class="logo hidden" viewBox="0 0 680 180" role="img" aria-labelledby="logo-title">
              <title id="logo-title">TEXID</title>
              <defs>
                <linearGradient id="g" x1="0" x2="1">
                  <stop offset="0%" stop-color="#7dd3fc"/>
                  <stop offset="100%" stop-color="#38bdf8"/>
                </linearGradient>
                <filter id="glow" x="-50%" y="-50%" width="200%" height="200%">
                  <feGaussianBlur stdDeviation="4" result="b"/>
                  <feMerge>
                    <feMergeNode in="b"/>
                    <feMergeNode in="SourceGraphic"/>
                  </feMerge>
                </filter>
              </defs>
              <text x="50%" y="58%" text-anchor="middle" class="logo-fill">TEXID</text>
              <text x="50%" y="58%" text-anchor="middle" class="logo-stroke">TEXID</text>
            </svg>
          </div>
          <div class="hero-actions">
            <button id="btn-start-solo" class="btn primary lg">Solo</button>
            <button id="btn-start-multi" class="btn lg">Multijoueur</button>
            <button id="btn-hero-top10" class="btn lg ghost">Top 10</button>
          </div>
          <div class="hero-desc" role="note" aria-label="Présentation">
            <span class="hd-ico" aria-hidden="true">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M12 2l2.5 5 5.5.8-4 3.9.9 5.5L12 15.9 7.1 17.2 8 11.7 4 7.8l5.5-.8L12 2z"/></svg>
            </span>
            <p class="subtitle">Affrontez un adversaire en temps réel ou relevez vos propres défis en solo dans ce Tetris survitaminé. Guides de chute en mode Easy et effets néon futuristes assurent une prise en main immédiate et une ambiance éclatante !</p>
          </div>
          <div class="hero-stats" aria-live="polite">
            <div class="hs-grid">
              <div class="hs-item">
                <div class="hs-top">
                  <span class="hs-ico" aria-hidden="true"><svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M3 3h8v8H3zM13 3h8v8h-8zM3 13h8v8H3zM13 13h8v8h-8z"/></svg></span>
                  <span class="hs-lab">Parties</span>
                  <strong id="hs-total" class="hs-val">–</strong>
                </div>
                <div class="hs-bar"><span></span></div>
              </div>
              <div class="hs-item">
                <div class="hs-top">
                  <span class="hs-ico" aria-hidden="true"><svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg></span>
                  <span class="hs-lab">Batailles</span>
                  <strong id="hs-battle" class="hs-val">–</strong>
                </div>
                <div class="hs-bar"><span></span></div>
              </div>
              <div class="hs-item">
                <div class="hs-top">
                  <span class="hs-ico" aria-hidden="true"><svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M16 11a4 4 0 10-8 0 4 4 0 008 0zm-4 5c-4.418 0-8 2.239-8 5v2h16v-2c0-2.761-3.582-5-8-5z"/></svg></span>
                  <span class="hs-lab">Joueurs</span>
                  <strong id="hs-players" class="hs-val">–</strong>
                </div>
                <div class="hs-bar"><span></span></div>
              </div>
            </div>
          </div>
          <p class="start-tip"></p>
        </div>
        <div class="hero-footer" title="Infos développeur">
          <span class="hf-line">Powered by Kham</span>
          <span class="hf-sep">•</span>
          <span class="hf-line">Epixid</span>
          <span class="hf-sep">•</span>
          <span class="hf-line">08‑08‑2025</span>
          <span class="hf-sep">•</span>
          <span class="hf-line">v1.0</span>
        </div>
      </div>
    </section>

    <!-- Écran rejoindre -->
    <section id="screen-join" class="screen">
      <div class="join-wrap">
        <h2>Multijoueurs</h2>
        <div class="join-layout">
          <div class="join-main">
            <div class="join-panel">
              <div class="join-panel-header">
                <div class="join-tabs">
                  <button id="tab-rooms" class="tab active">Parties</button>
                  <button id="tab-players" class="tab">Joueurs</button>
                </div>
                <div class="join-actions">
                  <button id="btn-join-create" class="btn primary">Créer une partie</button>
                  <button id="btn-join-back" class="btn danger sm" title="Retour à l'accueil" aria-label="Accueil">
                    <svg class="ico" width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M10 17l5-5-5-5v10zm-6-9h2v8H4V8zm12-6H8a2 2 0 00-2 2v2h2V4h8v16H8v-2H6v2a2 2 0 002 2h8a2 2 0 002-2V4a2 2 0 00-2-2z"/></svg>
                    <span class="visually-hidden">Accueil</span>
                  </button>
                </div>
              </div>
              <div class="join-panel-body">
                <ul id="rooms-join" class="rooms"></ul>
                <ul id="players-join" class="players"></ul>
                <div id="join-empty" class="empty-state hidden">Aucun élément à afficher.</div>
              </div>
            </div>
          </div>
        </div>
        <div class="join-summary-band">
          <div id="rooms-summary" class="rooms-summary" aria-live="polite">
            <ul class="rs-list" role="list">
              <li class="rs-item">
                <span class="rs-ico" aria-hidden="true"><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M3 3h8v8H3zM13 3h8v8h-8zM3 13h8v8H3zM13 13h8v8h-8z"/></svg></span>
                <span class="rs-lab">Parties</span>
                <strong id="rs-total" class="rs-val">–</strong>
              </li>
              <li class="rs-sep" aria-hidden="true">•</li>
              <li class="rs-item">
                <span class="rs-ico" aria-hidden="true"><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M16 11a4 4 0 10-8 0 4 4 0 008 0zm-4 5c-4.418 0-8 2.239-8 5v2h16v-2c0-2.761-3.582-5-8-5z"/></svg></span>
                <span class="rs-lab">Joueurs</span>
                <strong id="rs-players" class="rs-val">–</strong>
              </li> 
              <li class="rs-sep" aria-hidden="true">•</li>
              <li class="rs-item">
                <span class="rs-ico" aria-hidden="true"><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M8 5v14l11-7z"/></svg></span>
                <span class="rs-lab">Batailles</span>
                <strong id="rs-battle" class="rs-val">–</strong>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </section>

    <!-- Écran de jeu -->
    <div id="app" class="screen">
      <header class="topbar">
        <div class="brand"><h1 class="app-title">TEXID</h1></div>
        <div class="controls">
          <button id="btn-leaderboard" class="btn" title="Top 10" aria-label="Top 10">
            <svg class="ico" width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M9 21V8h6v13H9zm8 0V4h4v17h-4zM3 21v-9h4v9H3z"/></svg>
            <span class="visually-hidden">Top 10</span>
          </button>
          <button id="btn-help" class="btn" title="Aide" aria-label="Aide">
            <svg class="ico" width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M12 2a10 10 0 100 20 10 10 0 000-20zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92A3.5 3.5 0 0013 14h-2v-.5c0-.83.34-1.58.88-2.12l1.24-1.26a1.5 1.5 0 10-2.12-2.12c-.4.4-.62.94-.62 1.5H8a4 4 0 117.07 2.37z"/></svg>
            <span class="visually-hidden">Aide</span>
          </button>
          <button id="easy-btn" class="btn toggle" aria-pressed="false" aria-haspopup="menu" aria-expanded="false" title="Mode Easy (affiche le meilleur point de chute)">
            <svg class="ico" width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" focusable="false"><path d="M13 3L4 14h6l-1 7 9-11h-6l1-7z"/></svg>
            <svg class="caret" width="12" height="12" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" focusable="false"><path d="M7 10l5 5 5-5z"/></svg>
            <span class="visually-hidden">Mode Easy</span>
          </button>
          <div id="ai-dd" class="ai-dd hidden" role="menu" aria-label="Profil IA">
            <button class="ai-opt" role="menuitemradio" aria-checked="true" data-value="off" title="Désactive le Mode Easy"><span class="ai-ico">⏻</span><span class="ai-lab">Off</span></button>
            <button class="ai-opt" role="menuitemradio" aria-checked="false" data-value="prudent" title="Très strict: évite les trous/overhangs; stabilité avant tout"><span class="ai-ico">🧱</span><span class="ai-lab">Prudent</span></button>
            <button class="ai-opt" role="menuitemradio" aria-checked="false" data-value="conservateur" title="Empilement sûr; pénalités fortes sur trous/puits/overhangs"><span class="ai-ico">🛡️</span><span class="ai-lab">Conservateur</span></button>
            <button class="ai-opt" role="menuitemradio" aria-checked="false" data-value="equilibre" title="Compromis; lookahead équilibré"><span class="ai-ico">⚖️</span><span class="ai-lab">Équilibré</span></button>
            <button class="ai-opt" role="menuitemradio" aria-checked="false" data-value="agressif" title="Favorise clears 3+; pénalités adoucies"><span class="ai-ico">🔥</span><span class="ai-lab">Agressif</span></button>
          </div>
          <button id="btn-new" class="btn" title="Nouvelle partie / Prêt" aria-label="Nouvelle partie">
            <!-- Icône Solo: Plus -->
            <svg class="ico ico-plus" width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M11 4h2v6h6v2h-6v6h-2v-6H5v-2h6z"/></svg>
            <!-- Icônes Multi: Pouce haut / bas -->
            <svg class="ico ico-thumb-up" width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M2 21h4V9H2v12zm20-11c0-1.1-.9-2-2-2h-6l1-4-6 7v9h11c1.1 0 2-.9 2-2v-8z"/></svg>
            <svg class="ico ico-thumb-down" width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M2 3h4v12H2V3zm20 11c0 1.1-.9 2-2 2h-6l1 4-6-7V4h11c1.1 0 2 .9 2 2v8z"/></svg>
            <span class="visually-hidden">Nouvelle partie</span>
          </button>
          <button id="btn-mp-leave" class="btn danger" title="Quitter" aria-label="Quitter">
            <svg class="ico" width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M10 17l5-5-5-5v10zm-6-9h2v8H4V8zm12-6H8a2 2 0 00-2 2v2h2V4h8v16H8v-2H6v2a2 2 0 002 2h8a2 2 0 002-2V4a2 2 0 00-2-2z"/></svg>
            <span class="visually-hidden">Quitter</span>
          </button>
        </div>
      </header>

  <main class="layout">
        <section class="boards">
          <div id="wait-banner" class="wait hidden">En attente d'un joueur…</div>
          <div class="board-wrap" id="board-me">
            <div class="frame">
              <canvas id="game" width="300" height="600" aria-label="Grille de jeu"></canvas>
              <canvas id="fx" width="300" height="600" class="fx" aria-hidden="true"></canvas>
            </div>
            <div class="hint"><span id="me-label">Joueur A</span></div>
          </div>
          <div class="board-wrap" id="board-opp">
            <div class="frame">
              <canvas id="opp" width="300" height="600" aria-label="Grille adverse"></canvas>
            </div>
            <div class="hint"><span id="opp-label">Adversaire</span></div>
          </div>
          <!-- Vue dédiée spectateur: deuxième cadre pour afficher le joueur de droite si nécessaire -->
          <div class="board-wrap hidden" id="board-obs-right">
            <div class="frame">
              <canvas id="obs-right" width="300" height="600" aria-label="Grille observée (droite)"></canvas>
            </div>
            <div class="hint"><span id="obs-right-label">Joueur B</span></div>
          </div>
          <!-- Overlay compte à rebours avec annulation -->
          <div id="countdown-overlay" class="countdown hidden" role="dialog" aria-live="polite">
            <div class="countdown-box">
              <div class="countdown-text"><span id="countdown-text">5</span></div>
              <button id="btn-cancel-countdown" class="btn">Annuler</button>
            </div>
          </div>
        </section>

        <aside class="sidebar">
          <div class="panel status">
            <div class="stat"><span>Niveau</span><strong id="level">1 — Pepouz</strong></div>
            <div class="stat big"><span>Score</span><strong id="score">0</strong></div>
            <div class="stat"><span>Lignes</span><strong id="lines">0</strong></div>
          </div>
          <div id="panel-mp" class="panel board">
            <h2>Multijoueur</h2>
            <ul id="players-list" class="players-list"></ul>
          </div>

          <div class="panel next">
            <h2>Blocs</h2>
            <div class="next-wrap">
              <canvas id="next" width="120" height="120"></canvas>
              <canvas id="next2" width="120" height="120"></canvas>
            </div>
          </div>

          <div class="panel opp-preview">
            <h2>Adversaire</h2>
            <canvas id="opp-mini" width="120" height="240" aria-label="Aperçu adversaire"></canvas>
          </div>

          <div class="panel emotes">
            <div class="emotes-title">
              <h2>Emotes</h2>
              <button id="emotes-more" class="btn icon sm" aria-label="Afficher tous les emotes" title="Afficher tous les emotes" aria-expanded="false" aria-controls="emotes-grid">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M4 4h6v6H4zM14 4h6v6h-6zM4 14h6v6H4zM14 14h6v6h-6z"/></svg>
              </button>
            </div>
            <div class="emotes-top" id="emotes-top" role="list" aria-label="Favoris (les plus utilisés)"></div>
            <div id="emotes-grid" class="emotes-grid" role="list" aria-label="Réactions (envoyées à l'adversaire)">
              <!-- Positifs en premier -->
              <button class="emote emote-pos" data-emote="😜" title="Se moquer" role="listitem">😜</button>
              <button class="emote emote-pos" data-emote="😂" title="Rigoler" role="listitem">😂</button>
              <button class="emote emote-pos" data-emote="👏" title="Bravo" role="listitem">👏</button>
              <button class="emote emote-pos" data-emote="🔥" title="Feu" role="listitem">🔥</button>
              <!-- Négatifs ensuite -->
              <button class="emote emote-neg" data-emote="😭" title="Pleurer" role="listitem">😭</button>
              <button class="emote emote-neg" data-emote="😴" title="Dormir" role="listitem">😴</button>
              <button class="emote emote-neg" data-emote="😠" title="Énervé" role="listitem">😠</button>
              <button class="emote emote-neg" data-emote="😡" title="Colère" role="listitem">😡</button>
              <button class="emote emote-neg" data-emote="🤡" title="Se moquer+" role="listitem">🤡</button>
              <button class="emote emote-neg" data-emote="💤" title="Zzz" role="listitem">💤</button>
            </div>
          </div>
        </aside>
        <!-- Panneaux sous le plateau (mobile): statut + multijoueur -->
        <section id="under-panels" class="under-panels"></section>
      </main>

      <footer class="bottombar">
        <span id="player-tag">Joueur: <strong id="player-name">–</strong></span>
    <span id="room-tag" class="hidden">Partie: <strong id="room-id">–</strong></span>
      </footer>
    </div>

    <!-- Modales -->
    <dialog id="dlg-name" class="modal">
      <form method="dialog" class="modal-content" id="form-name">
        <h3>Entrez votre nom</h3>
        <input id="input-name" name="name" type="text" maxlength="16" placeholder="Votre pseudo" autofocus required />
        <menu>
          <button type="button" value="cancel">Annuler</button>
          <button type="submit" value="default" class="primary">Valider</button>
        </menu>
      </form>
    </dialog>

    <dialog id="dlg-gameover" class="modal">
      <div class="modal-content">
        <h3>Game Over</h3>
  <p>Score: <strong id="final-score">0</strong></p>
  <p>Score adverse: <strong id="opp-final-score">–</strong></p>
        <menu>
          <button id="go-new" class="primary">Rejouer</button>
          <button id="go-close">Fermer</button>
        </menu>
      </div>
    </dialog>

    <dialog id="dlg-result" class="modal">
      <div class="modal-content">
        <h3>Résultat du match</h3>
        <div id="result-lines">–</div>
        <menu>
          <button id="res-replay" class="primary">Rejouer</button>
          <button id="res-leave">Quitter la partie</button>
        </menu>
      </div>
    </dialog>

    <dialog id="dlg-confirm-leave" class="modal">
      <div class="modal-content">
        <h3>Quitter</h3>
        <p>Quitter le salon et revenir à l’écran de titre ?</p>
  <p>Quitter la partie et revenir à l’écran de titre ?</p>
        <menu>
          <button id="cancel-leave">Annuler</button>
          <button id="confirm-leave" class="primary">Quitter</button>
        </menu>
      </div>
    </dialog>

    <dialog id="dlg-top10" class="modal">
      <div class="modal-content">
        <div class="hero-top10-header">
          <h3>Top 10</h3>
          <div class="tabs tabs-compact" role="tablist" aria-label="Classements">
            <button id="tab-top-solo" class="tab active" role="tab" aria-selected="true" aria-controls="top10-solo">Solo</button>
            <button id="tab-top-multi" class="tab" role="tab" aria-selected="false" aria-controls="top10-multi">Multi</button>
          </div>
          <button id="top10-close-x" class="btn" aria-label="Fermer"></button>
        </div>
        <div class="tabpanes">
          <div id="top10-solo" role="tabpanel" aria-labelledby="tab-top-solo">
            <ol id="top10-modal-solo" class="top10 neon"></ol>
          </div>
          <div id="top10-multi" role="tabpanel" aria-labelledby="tab-top-multi" hidden>
            <ol id="top10-modal-multi" class="top10 neon"></ol>
          </div>
        </div>
      </div>
    </dialog>

  <script type="module" src="/src/main.js"></script>

  <!-- Modale Top 10 (héro stylé) -->
  <dialog id="dlg-top10-hero" class="modal hero-top10">
    <div class="modal-content">
      <div class="hero-top10-header">
        <h3>Top 10</h3>
        <div class="tabs tabs-compact" role="tablist" aria-label="Classements">
          <button id="tab-hero-solo" class="tab active" role="tab" aria-selected="true" aria-controls="hero-top10-solo">Solo</button>
          <button id="tab-hero-multi" class="tab" role="tab" aria-selected="false" aria-controls="hero-top10-multi">Multi</button>
        </div>
  <button id="top10-hero-close" class="btn" aria-label="Fermer"></button>
      </div>
      <div class="hero-top10-body">
        <div id="hero-top10-solo" role="tabpanel" aria-labelledby="tab-hero-solo">
          <ol id="top10-hero-list-solo" class="top10 neon"></ol>
        </div>
        <div id="hero-top10-multi" role="tabpanel" aria-labelledby="tab-hero-multi" hidden>
          <ol id="top10-hero-list-multi" class="top10 neon"></ol>
        </div>
      </div>
    </div>
  </dialog>

    <!-- Modale Observateurs -->
    <dialog id="dlg-spectators" class="modal">
      <div class="modal-content">
        <h3>Observateurs</h3>
        <ul id="spectators-list" class="players"></ul>
        <menu>
          <button id="spectators-close" class="primary">Fermer</button>
        </menu>
      </div>
    </dialog>

  <!-- Modale Aide / Contrôles -->
  <dialog id="dlg-help" class="modal">
    <div class="modal-content">
      <h3>Aide & Contrôles</h3>
      <div class="help-body">
        <ul>
          <li>← →: déplacer</li>
          <li>↑: rotation</li>
          <li>↓: descente</li>
          <li>Espace: chute</li>
          <li>P: pause</li>
        </ul>
        <p class="small">Astuce: activez le Mode Easy pour les guides de projection.</p>
      </div>
      <menu>
        <button id="help-close" class="primary">Fermer</button>
      </menu>
    </div>
  </dialog>
  </body>
  </html>
